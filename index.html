const { useState, useEffect } = React;

/**
 * DATA CONFIGURATION
 */
const PORTFOLIO_DATA = {
  personal: {
    name: "Sruthy K",
    role: "Software Tester",
    tagline: "Elevating software quality, one test case at a time.",
    bio: "Passionate about breaking software so your users don't have to. I specialize in uncovering hidden bugs, optimizing performance, and ensuring digital perfection.",
    email: "sruthykrishna045@gmail.com",
    socials: {
      github: "https://github.com",
      linkedin: "https://linkedin.com/in/sruthy-k2003/",
    }
  },
  skills: [
    { name: "Manual Testing", icon: "search", level: 95 },
    { name: "Selenium Automation", icon: "bot", level: 85 },
    { name: "API Testing (Postman)", icon: "plug", level: 80 },
    { name: "Jira / Bug Tracking", icon: "bug", level: 90 },
    { name: "SQL Database Testing", icon: "database", level: 80 },
    { name: "Performance (JMeter)", icon: "gauge", level: 75 }
  ],
  projects: [
    {
      id: 1,
      title: "OrangeHRM Manual Testing",
      description: "A comprehensive testing project for the OrangeHRM web application focused on validating core HR modules such as Login, Employee Management (PIM), and Leave using manual testing.",
      tags: ["Manual Testing", "Test Case Design", "Bug Tracking", "Jira"],
      image: "https://images.unsplash.com/photo-1581092334709-efc9c2bb2c6c?auto=format&fit=crop&q=80&w=800"
    },
    {
      id: 2,
      title: "ParaBank Web Automation",
      description: "Automated critical banking workflows using Selenium WebDriver with Java, focusing on reducing manual effort for repetitive scenarios.",
      tags: ["Java", "Selenium", "TestNG", "Maven"],
      image: "https://images.unsplash.com/photo-1574856342191-ee518e388c3a?auto=format&fit=crop&q=80&w=800"
    },
    {
      id: 3,
      title: "E-Commerce Regression Suite",
      description: "Designed a maintainable Selenium framework to automate checkout and payment workflows, reducing regression cycle time significantly.",
      tags: ["Selenium", "Automation", "E-commerce"],
      image: "https://images.unsplash.com/photo-1555099962-4199c345e5dd?auto=format&fit=crop&q=80&w=800"
    }
  ]
};

// Reusable Icon Component for CDN version
const Icon = ({ name, className = "", size = 20 }) => {
  useEffect(() => {
    if (window.lucide) window.lucide.createIcons();
  }, [name]);
  return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
};

const App = () => {
  const [isDark, setIsDark] = useState(true);
  const [expandedProjectId, setExpandedProjectId] = useState(null);
  const [enhancedDescription, setEnhancedDescription] = useState({});
  const [loadingId, setLoadingId] = useState(null);
  const [error, setError] = useState(null);

  const toggleTheme = () => setIsDark(!isDark);

  const callGeminiAPI = async (userQuery) => {
    const systemPrompt = "You are a professional QA resume writer. Rewrite the following project description into two high-impact, professional paragraphs focusing on technical skills and business impact. Do not use markdown bolding.";
    const apiKey = ""; // Environment handles this
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

    const payload = {
      contents: [{ parts: [{ text: userQuery }] }],
      systemInstruction: { parts: [{ text: systemPrompt }] },
    };

    let attempts = 0;
    while (attempts < 5) {
      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (response.status === 429) {
          await new Promise(r => setTimeout(r, Math.pow(2, attempts) * 1000));
          attempts++;
          continue;
        }
        const result = await response.json();
        return result.candidates?.[0]?.content?.parts?.[0]?.text;
      } catch (e) {
        if (attempts === 4) throw e;
        attempts++;
      }
    }
  };

  const handleEnhance = async (project) => {
    if (enhancedDescription[project.id]) {
      setExpandedProjectId(expandedProjectId === project.id ? null : project.id);
      return;
    }
    setLoadingId(project.id);
    setError(null);
    setExpandedProjectId(project.id);
    try {
      const text = await callGeminiAPI(`Title: ${project.title}. Desc: ${project.description}`);
      setEnhancedDescription(prev => ({ ...prev, [project.id]: text }));
    } catch (e) {
      setError("AI enhancement temporarily unavailable.");
    } finally {
      setLoadingId(null);
    }
  };

  return (
    <div className={`min-h-screen transition-colors duration-300 ${isDark ? 'bg-slate-950 text-white' : 'bg-white text-slate-900'}`}>
      {/* Navigation */}
      <nav className={`fixed w-full z-50 p-4 backdrop-blur-md border-b flex justify-between items-center ${isDark ? 'border-slate-800' : 'border-gray-200'}`}>
        <div className="font-bold text-2xl bg-gradient-to-r from-blue-500 to-purple-600 bg-clip-text text-transparent">
          {PORTFOLIO_DATA.personal.name.split(' ')[0]}.
        </div>
        <button onClick={toggleTheme} className={`p-2 rounded-full ${isDark ? 'text-yellow-400 hover:bg-slate-800' : 'text-slate-700 hover:bg-gray-100'}`}>
          <Icon name={isDark ? "sun" : "moon"} />
        </button>
      </nav>

      {/* Hero */}
      <section className="pt-40 pb-20 px-4 text-center relative overflow-hidden">
        <div className="max-w-4xl mx-auto relative z-10">
          <h2 className="text-blue-500 font-bold tracking-widest uppercase mb-4">{PORTFOLIO_DATA.personal.role}</h2>
          <h1 className="text-5xl md:text-7xl font-extrabold mb-6 tracking-tight">
            Hello, I'm <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-purple-600">{PORTFOLIO_DATA.personal.name}</span>
          </h1>
          <p className="text-xl text-gray-400 max-w-2xl mx-auto mb-10 leading-relaxed">{PORTFOLIO_DATA.personal.tagline}</p>
          <div className="flex justify-center gap-4">
            <a href={`mailto:${PORTFOLIO_DATA.personal.email}`} className="bg-blue-600 text-white px-8 py-4 rounded-full font-bold hover:bg-blue-700 transition transform hover:scale-105 shadow-lg shadow-blue-500/20">Hire Me</a>
            <a href="#projects" className="border border-gray-700 px-8 py-4 rounded-full font-bold hover:bg-gray-800 transition">View Work</a>
          </div>
        </div>
      </section>

      {/* Skills Grid */}
      <section className={`py-20 px-4 ${isDark ? 'bg-slate-900/50' : 'bg-gray-50'}`}>
        <div className="max-w-7xl mx-auto">
          <h2 className="text-3xl font-bold mb-12 text-center">Technical Expertise</h2>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {PORTFOLIO_DATA.skills.map((skill, i) => (
              <div key={i} className={`p-6 rounded-2xl border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-200 shadow-sm'}`}>
                <div className="flex items-center gap-3 mb-4">
                  <div className="p-2 bg-blue-500/10 text-blue-500 rounded-lg"><Icon name={skill.icon} /></div>
                  <span className="font-bold">{skill.name}</span>
                </div>
                <div className="w-full bg-gray-700 rounded-full h-1.5 overflow-hidden">
                  <div className="bg-blue-600 h-full rounded-full transition-all duration-1000" style={{ width: `${skill.level}%` }}></div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </section>

      {/* Projects */}
      <section id="projects" className="py-20 px-4 max-w-7xl mx-auto">
        <h2 className="text-3xl font-bold mb-12 text-center">Featured Work</h2>
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-10">
          {PORTFOLIO_DATA.projects.map(project => (
            <div key={project.id} className={`rounded-2xl border overflow-hidden transition-all hover:shadow-2xl ${isDark ? 'bg-slate-900 border-slate-800' : 'bg-white border-gray-100 shadow-xl'}`}>
              <img src={project.image} className="w-full h-56 object-cover opacity-80" />
              <div className="p-8">
                <h3 className="text-2xl font-bold mb-3">{project.title}</h3>
                <p className={`mb-6 leading-relaxed ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>{project.description}</p>
                <div className="flex flex-wrap gap-2 mb-6">
                  {project.tags.map(tag => (
                    <span key={tag} className="text-[10px] uppercase font-bold tracking-wider bg-blue-500/10 text-blue-400 px-3 py-1 rounded-full border border-blue-500/20">{tag}</span>
                  ))}
                </div>
                
                <button 
                  onClick={() => handleEnhance(project)}
                  className={`w-full py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all ${
                    loadingId === project.id ? 'bg-slate-700 cursor-wait' : 'bg-yellow-500 text-slate-900 hover:bg-yellow-400'
                  }`}
                >
                  {loadingId === project.id ? 'Analyzing...' : (enhancedDescription[project.id] ? 'Toggle AI Summary' : 'Enhance with AI ✨')}
                </button>

                {expandedProjectId === project.id && enhancedDescription[project.id] && (
                  <div className={`mt-4 p-4 rounded-xl border animate-fade-in ${isDark ? 'bg-blue-950/30 border-blue-500/30' : 'bg-blue-50 border-blue-200'}`}>
                    <p className="text-sm leading-relaxed whitespace-pre-wrap">{enhancedDescription[project.id]}</p>
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>
      </section>

      <footer className="py-20 text-center border-t border-slate-800 opacity-50">
        <p>© {new Date().getFullYear()} {PORTFOLIO_DATA.personal.name}. Software Tester Portfolio.</p>
      </footer>
    </div>
  );
};

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
